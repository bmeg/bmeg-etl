
class: sifter
outdir: ../../output/msigdb
name: msigdb

config:
  xmlPath:
    type: File
    default: ../../source/msigdb/msigdb_v7.5.1.xml
  schema:
    type: File
    default: ../../src/bmeg/bmeg-dictionary/gdcdictionary/schemas/
  gene2ensembl:
    type: File
    default: ../../source/ensembl/gene2ensembl.translate.link.json.gz

inputs:
  loader:
    xmlLoad:
      input: "{{config.xmlPath}}"

pipelines:
  transform:
    - from: loader
    - fieldProcess:
        field: MSIGDB
    - fieldProcess:
        field: GENESET
    - emit:
        name: raw
    - project:
        mapping:
          project_id: Reference
        rename:
          "-STANDARD_NAME": standard_name
          "-HISTORICAL_NAMES": historical_names
          "-GEOID": geoid
          "-EXACT_SOURCE": exact_source
          "-GENESET_LISTING_URL": geneset_listing_url
          "-EXTERNAL_DETAILS_URL": external_details_url
          "-CHIP": chip
          "-CATEGORY_CODE": category_code
          "-SUB_CATEGORY_CODE": sub_category_code
          "-CONTRIBUTOR": contributor
          "-CONTRIBUTOR_ORG": contributor_org
          "-DESCRIPTION_BRIEF": description_brief
          "-DESCRIPTION_FULL": description_full
          "-SYSTEMATIC_NAME": submitter_id
          "-MEMBERS_EZID": genes
          PMID: publications

    - map:
        method: splt
        gpython: |
          def splt(x):
            x['genes'] = x['genes'].split(",")
            return x

    - lookup:
        json:
          input: "{{config.gene2ensembl}}"
          key: GeneID
          value: Ensembl_gene_identifier
        replace: genes

    - emit:
        name: record

  object:
    - from: transform
    - objectCreate:
        class: gene_set
        schema: "{{config.schema}}"
    - emit:
        name: gene_set
